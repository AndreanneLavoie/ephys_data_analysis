# ephys_data_analysis_prep
Converts data generated by ephys recording, otogenetics, visual stimuli order etc. into organised data structure.

PROCEDURE

1. Collect Data and Store it as followed:

*Intan Data 

a single folder called IntanData will hold all subholders 
(NOTE: one subfolder per whole recording run - cannot have sub-subfolders to organize per experiment as path will be different)

Naming: 'expName' + '_' + 'ephys' + '_' + 'data(yymmdd)'

*Visual Stimulation

a single folder called VSpara will hold all .csv files (one per whole recording run) 

Naming: 'expName' + _ + date(yymmdd)


2. Run KiloSort on Ephys Data in matlab

>> runKiloSort4Intan2

  -> then select all the ephys recoring channels 
  -> then select the electrode you used ***make sure the number of electrode matches the number of channels
  

3. Run Phy on Sorted Data

  -> copy directory where new kilosort data is saved (in KilosortDatas subfolder where specific run is saved)
  -> open anaconda prompt
      >> cd/D E:           (this will change to a different disk on the computer)
      >> cd {past data path}
      >> activate phy
      >> phy tempalte-gui params.py
  
  -> sort your data; remember to save as this will create the required 'cluster_groups.csv'
  
  4. Create Spike structure in Matlab
  
  >> spikes = create_spikes_phy
      -> selct folder with data in IntanData
      -> select info.rhd file
      
  5. Analyse Data and create figures and plots
  
  *Orientation Tuning:
  
  >> data_analysis_ori(spikes, unitID)      (this will plot three tuning curves of the unit - tuning, negative and spontaneous)
  >> psth_bl(spikes, unitID)                (this will plot the psth histogram from -1 to 3 sec (with 2 sec in middle being stim on))
  
  NOTE: can change code to modify which type of data is filtered
  
  *Receptive Field
  
  >> data_analysis_fr_6x8     (this will plot a heat map for on and off receptive field based on population activity)
  
  
      
